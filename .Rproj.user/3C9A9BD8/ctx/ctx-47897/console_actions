{
    "type": [
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        2,
        3,
        2,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        2,
        0,
        1,
        2,
        3,
        2,
        0,
        1,
        2,
        3,
        2,
        0,
        1,
        3,
        0,
        1,
        2,
        2,
        2,
        2,
        2,
        0,
        1,
        3,
        3,
        0,
        1,
        2,
        3,
        2,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        2,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        3,
        0,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        2
    ],
    "data": [
        "         \"Other\" = \"Data for this country is not available.\")",
        "+ ",
        "}",
        "> ",
        "# User Interface",
        "> ",
        "ui <- fluidPage(",
        "+ ",
        "  titlePanel(\"Public Administration Workers Report\"),",
        "+ ",
        "  sidebarLayout(",
        "+ ",
        "    sidebarPanel(",
        "+ ",
        "      selectInput(\"country\", \"Select Country:\", choices = NULL),",
        "+ ",
        "      downloadButton(\"download_report\", \"Download Report\")",
        "+ ",
        "    ),",
        "+ ",
        "    mainPanel(",
        "+ ",
        "      h3(\"Selected Country Information\"),",
        "+ ",
        "      plotOutput(\"country_plot\"),",
        "+ ",
        "      textOutput(\"country_text\"),",
        "+ ",
        "      verbatimTextOutput(\"mean_share\")",
        "+ ",
        "    )",
        "+ ",
        "  )",
        "+ ",
        ")",
        "> ",
        "# Server Logic",
        "> ",
        "server <- function(input, output, session) {",
        "+ ",
        "  # Populate country choices dynamically",
        "+ ",
        "  observe({",
        "+ ",
        "    updateSelectInput(session, \"country\", choices = unique(data$country))",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  # Generate Reactive Report Content",
        "+ ",
        "  report_content <- reactive({",
        "+ ",
        "    req(input$country)  # Ensure input$country is selected",
        "+ ",
        "    country_data <- subset(data, country == input$country)",
        "+ ",
        "    ",
        "+ ",
        "    if (nrow(country_data) == 0) return(NULL)",
        "+ ",
        "    ",
        "+ ",
        "    mean_share <- mean(",
        "+ ",
        "      country_data$public_admin_workers / country_data$total_public_employees, ",
        "+ ",
        "      na.rm = TRUE",
        "+ ",
        "    )",
        "+ ",
        "    ",
        "+ ",
        "    # Create the Plot",
        "+ ",
        "    plot <- ggplot(country_data, aes(x = country, y = public_admin_workers / total_public_employees)) +",
        "+ ",
        "      geom_bar(stat = \"identity\", fill = \"steelblue\") +",
        "+ ",
        "      labs(",
        "+ ",
        "        title = paste(\"Public Administration Workers Share for\", input$country),",
        "+ ",
        "        y = \"Share of Public Employees\",",
        "+ ",
        "        x = \"Country\"",
        "+ ",
        "      ) +",
        "+ ",
        "      theme_minimal()",
        "+ ",
        "    ",
        "+ ",
        "    # Save the plot as an image in a temporary file",
        "+ ",
        "    plot_filename <- tempfile(fileext = \".png\")",
        "+ ",
        "    ggsave(plot_filename, plot = plot, width = 7, height = 7)",
        "+ ",
        "    ",
        "+ ",
        "    # Prepare the country-specific text",
        "+ ",
        "    country_text <- paste(",
        "+ ",
        "      \"Detailed report for\", input$country, ",
        "+ ",
        "      \"showcasing public sector workforce trends.\"",
        "+ ",
        "    )",
        "+ ",
        "    ",
        "+ ",
        "    # Return a list of report components",
        "+ ",
        "    list(",
        "+ ",
        "      text = country_text, ",
        "+ ",
        "      plot_filename = plot_filename, ",
        "+ ",
        "      mean_share = mean_share",
        "+ ",
        "    )",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  # Render Plot",
        "+ ",
        "  output$country_plot <- renderPlot({",
        "+ ",
        "    req(input$country)",
        "+ ",
        "    country_data <- subset(data, country == input$country)",
        "+ ",
        "    ggplot(country_data, aes(x = country, y = public_admin_workers / total_public_employees)) +",
        "+ ",
        "      geom_bar(stat = \"identity\", fill = \"steelblue\") +",
        "+ ",
        "      labs(",
        "+ ",
        "        title = paste(\"Public Administration Workers Share for\", input$country),",
        "+ ",
        "        y = \"Share of Public Employees\",",
        "+ ",
        "        x = \"Country\"",
        "+ ",
        "      ) +",
        "+ ",
        "      theme_minimal()",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  # Display Text and Mean Share",
        "+ ",
        "  output$country_text <- renderText({",
        "+ ",
        "    req(report_content())",
        "+ ",
        "    report_content()$text",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  output$mean_share <- renderText({",
        "+ ",
        "    req(report_content())",
        "+ ",
        "    paste(\"Mean Share of Public Admin Workers:\", round(report_content()$mean_share, 2))",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  # Generate and Download Report",
        "+ ",
        "  output$download_report <- downloadHandler(",
        "+ ",
        "    filename = function() {",
        "+ ",
        "      paste(\"report_\", input$country, \".docx\", sep = \"\")",
        "+ ",
        "    },",
        "+ ",
        "    content = function(file) {",
        "+ ",
        "      tryCatch({",
        "+ ",
        "        quarto_file <- \"C:WBG/GitHub/WWBI/Code/report_template_shiny_app.qmd\"",
        "+ ",
        "        ",
        "+ ",
        "        # Ensure the Quarto file exists",
        "+ ",
        "        if (!file.exists(quarto_file)) {",
        "+ ",
        "          stop(\"Quarto template file not found.\")",
        "+ ",
        "        }",
        "+ ",
        "        ",
        "+ ",
        "        # Define a temporary file name for Quarto's output",
        "+ ",
        "        temp_output <- tempfile(fileext = \".docx\")",
        "+ ",
        "        ",
        "+ ",
        "        # Render the Quarto report",
        "+ ",
        "        quarto::quarto_render(",
        "+ ",
        "          input = quarto_file,",
        "+ ",
        "          output_file = basename(temp_output),  # Pass only the file name",
        "+ ",
        "          execute_params = list(",
        "+ ",
        "            report_text = report_content()$text,",
        "+ ",
        "            plot_filename = report_content()$plot_filename,",
        "+ ",
        "            mean_share = report_content()$mean_share",
        "+ ",
        "          )",
        "+ ",
        "        )",
        "+ ",
        "        ",
        "+ ",
        "        # Move the generated file to the target location",
        "+ ",
        "        file.rename(temp_output, file)",
        "+ ",
        "      }, error = function(e) {",
        "+ ",
        "        showNotification(paste(\"Error:\", e$message), type = \"error\")",
        "+ ",
        "      })",
        "+ ",
        "    }",
        "+ ",
        "  )",
        "+ ",
        "}",
        "> ",
        "# Run the Application",
        "> ",
        "shinyApp(ui = ui, server = server)",
        "\nListening on http://127.0.0.1:4595\n",
        "> ",
        "ui <- fluidPage(",
        "+ ",
        "  titlePanel(\"Public Sector Wage Premium\"),",
        "+ ",
        "  sidebarLayout(",
        "+ ",
        "    sidebarPanel(",
        "+ ",
        "      selectInput(\"countries_first\", \"Select Countries:\", choices = c(\"USA\", \"Canada\"), multiple = TRUE),",
        "+ ",
        "      selectInput(\"country_second\", \"Select Country:\", choices = c(\"USA\", \"Canada\")),",
        "+ ",
        "      sliderInput(\"year_range\", \"Select Year Range:\", min = 2000, max = 2022, value = c(2010, 2020)),",
        "+ ",
        "      downloadButton(\"download_report\", \"Download Report\")",
        "+ ",
        "    ),",
        "+ ",
        "    mainPanel(",
        "+ ",
        "      plotlyOutput(\"firstGraphgender\"),",
        "+ ",
        "      plotlyOutput(\"secondGraphgender\")",
        "+ ",
        "    )",
        "+ ",
        "  )",
        "+ ",
        ")",
        "> ",
        "server <- function(input, output) {",
        "+ ",
        "  # Generate the first graph",
        "+ ",
        "  output$firstGraphgender <- renderPlotly({",
        "+ ",
        "    plot_ly(x = ~input$countries_first, y = ~runif(length(input$countries_first)), type = 'bar')",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  # Generate the second graph",
        "+ ",
        "  output$secondGraphgender <- renderPlotly({",
        "+ ",
        "    plot_ly(x = seq(input$year_range[1], input$year_range[2]), y = runif(diff(input$year_range) + 1), type = 'scatter', mode = 'lines')",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  # Allow downloading of the Quarto document",
        "+ ",
        "  output$download_report <- downloadHandler(",
        "+ ",
        "    filename = function() {",
        "+ ",
        "      paste(\"Wage_Premium_Report_\", Sys.Date(), \".pdf\", sep = \"\")",
        "+ ",
        "    },",
        "+ ",
        "    content = function(file) {",
        "+ ",
        "      # Save graphs to temporary variables",
        "+ ",
        "      first_graph <- plotly::plotly_image(output$firstGraphgender())",
        "+ ",
        "      second_graph <- plotly::plotly_image(output$secondGraphgender())",
        "+ ",
        "      ",
        "+ ",
        "      # Define parameters to pass to Quarto",
        "+ ",
        "      params <- list(",
        "+ ",
        "        countries = paste(input$countries_first, collapse = \", \"),",
        "+ ",
        "        year_range = paste(input$year_range, collapse = \" - \"),",
        "+ ",
        "        first_graph = first_graph,",
        "+ ",
        "        second_graph = second_graph",
        "+ ",
        "      )",
        "+ ",
        "      ",
        "+ ",
        "      # Render the Quarto document",
        "+ ",
        "      rmarkdown::render(",
        "+ ",
        "        input = \"template.qmd\",",
        "+ ",
        "        output_file = file,",
        "+ ",
        "        params = params,",
        "+ ",
        "        envir = new.env(parent = globalenv()) # Isolate the environment",
        "+ ",
        "      )",
        "+ ",
        "    }",
        "+ ",
        "  )",
        "+ ",
        "}",
        "> ",
        "server <- function(input, output) {",
        "+ ",
        "  # Generate the first graph",
        "+ ",
        "  output$firstGraphgender <- renderPlotly({",
        "+ ",
        "    plot_ly(x = ~input$countries_first, y = ~runif(length(input$countries_first)), type = 'bar')",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  # Generate the second graph",
        "+ ",
        "  output$secondGraphgender <- renderPlotly({",
        "+ ",
        "    plot_ly(x = seq(input$year_range[1], input$year_range[2]), y = runif(diff(input$year_range) + 1), type = 'scatter', mode = 'lines')",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  # Allow downloading of the Quarto document",
        "+ ",
        "  output$download_report <- downloadHandler(",
        "+ ",
        "    filename = function() {",
        "+ ",
        "      paste(\"Wage_Premium_Report_\", Sys.Date(), \".pdf\", sep = \"\")",
        "+ ",
        "    },",
        "+ ",
        "    content = function(file) {",
        "+ ",
        "      # Save graphs to temporary variables",
        "+ ",
        "      first_graph <- plotly::plotly_image(output$firstGraphgender())",
        "+ ",
        "      second_graph <- plotly::plotly_image(output$secondGraphgender())",
        "+ ",
        "      ",
        "+ ",
        "      # Define parameters to pass to Quarto",
        "+ ",
        "      params <- list(",
        "+ ",
        "        countries = paste(input$countries_first, collapse = \", \"),",
        "+ ",
        "        year_range = paste(input$year_range, collapse = \" - \"),",
        "+ ",
        "        first_graph = first_graph,",
        "+ ",
        "        second_graph = second_graph",
        "+ ",
        "      )",
        "+ ",
        "      ",
        "+ ",
        "      # Render the Quarto document",
        "+ ",
        "      rmarkdown::render(",
        "+ ",
        "        input = \"report_template_shiny_app.qmd\",",
        "+ ",
        "        output_file = file,",
        "+ ",
        "        params = params,",
        "+ ",
        "        envir = new.env(parent = globalenv()) # Isolate the environment",
        "+ ",
        "      )",
        "+ ",
        "    }",
        "+ ",
        "  )",
        "+ ",
        "}",
        "> ",
        "shinyApp(ui = ui, server = server)",
        "\nListening on http://127.0.0.1:4595\nWarning: Error in : 'plotly_image' is not an exported object from 'namespace:plotly'\n  3: \u001B[37mrunApp\u001B[39m\n  2: \u001B[37mprint.shiny.appobj\u001B[39m\n  1: \u001B[37m<Anonymous>\u001B[39m\nWarning: Error in : 'plotly_image' is not an exported object from 'namespace:plotly'\n  3: \u001B[37mrunApp\u001B[39m\n  2: \u001B[37mprint.shiny.appobj\u001B[39m\n  1: \u001B[37m<Anonymous>\u001B[39m\n",
        "> ",
        "ui <- fluidPage(",
        "+ ",
        "  titlePanel(\"Public Sector Wage Premium\"),",
        "+ ",
        "  sidebarLayout(",
        "+ ",
        "    sidebarPanel(",
        "+ ",
        "      selectInput(\"countries_first\", \"Select Countries:\", choices = c(\"USA\", \"Canada\"), multiple = TRUE),",
        "+ ",
        "      selectInput(\"country_second\", \"Select Country:\", choices = c(\"USA\", \"Canada\")),",
        "+ ",
        "      sliderInput(\"year_range\", \"Select Year Range:\", min = 2000, max = 2022, value = c(2010, 2020)),",
        "+ ",
        "      downloadButton(\"download_report\", \"Download Report\")",
        "+ ",
        "    ),",
        "+ ",
        "    mainPanel(",
        "+ ",
        "      plotlyOutput(\"firstGraphgender\"),",
        "+ ",
        "      plotlyOutput(\"secondGraphgender\")",
        "+ ",
        "    )",
        "+ ",
        "  )",
        "+ ",
        ")",
        "> ",
        "server <- function(input, output) {",
        "+ ",
        "  # Generate the first graph",
        "+ ",
        "  first_graph <- reactive({",
        "+ ",
        "    plot_ly(x = ~input$countries_first, y = ~runif(length(input$countries_first)), type = 'bar')",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  output$firstGraphgender <- renderPlotly({",
        "+ ",
        "    first_graph()",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  # Generate the second graph",
        "+ ",
        "  second_graph <- reactive({",
        "+ ",
        "    plot_ly(x = seq(input$year_range[1], input$year_range[2]), y = runif(diff(input$year_range) + 1), ",
        "+ ",
        "            type = 'scatter', mode = 'lines')",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  output$secondGraphgender <- renderPlotly({",
        "+ ",
        "    second_graph()",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  # Allow downloading of the Quarto document",
        "+ ",
        "  output$download_report <- downloadHandler(",
        "+ ",
        "    filename = function() {",
        "+ ",
        "      paste(\"Wage_Premium_Report_\", Sys.Date(), \".html\", sep = \"\")",
        "+ ",
        "    },",
        "+ ",
        "    content = function(file) {",
        "+ ",
        "      # Save graphs as images",
        "+ ",
        "      temp_file_1 <- tempfile(fileext = \".png\")",
        "+ ",
        "      temp_file_2 <- tempfile(fileext = \".png\")",
        "+ ",
        "      ",
        "+ ",
        "      # Export plots as static images",
        "+ ",
        "      orca(first_graph(), temp_file_1)",
        "+ ",
        "      orca(second_graph(), temp_file_2)",
        "+ ",
        "      ",
        "+ ",
        "      # Define parameters to pass to Quarto",
        "+ ",
        "      params <- list(",
        "+ ",
        "        countries = paste(input$countries_first, collapse = \", \"),",
        "+ ",
        "        year_range = paste(input$year_range, collapse = \" - \"),",
        "+ ",
        "        first_graph_path = temp_file_1,",
        "+ ",
        "        second_graph_path = temp_file_2",
        "+ ",
        "      )",
        "+ ",
        "      ",
        "+ ",
        "      # Render the Quarto document",
        "+ ",
        "      rmarkdown::render(",
        "+ ",
        "        input = \"report_template_shiny_app.qmd\",",
        "+ ",
        "        output_file = file,",
        "+ ",
        "        params = params,",
        "+ ",
        "        envir = new.env(parent = globalenv()) # Isolate the environment",
        "+ ",
        "      )",
        "+ ",
        "    }",
        "+ ",
        "  )",
        "+ ",
        "}",
        "> ",
        "shinyApp(ui = ui, server = server)",
        "\nListening on http://127.0.0.1:4595\nWarning in orca(first_graph(), temp_file_1) : 'orca' is deprecated.\nUse 'kaleido' instead.\nSee help(\"Deprecated\")\nWarning: Error in : The orca command-line utility is required for this functionality.\n\nPlease follow the installation instructions here -- https://github.com/plotly/orca#installation\n  3: \u001B[37mrunApp\u001B[39m\n  2: \u001B[37mprint.shiny.appobj\u001B[39m\n  1: \u001B[37m<Anonymous>\u001B[39m\n\n",
        "> ",
        "install.packages(\"plotly\")",
        "Error in install.packages : Updating loaded packages\n\nRestarting R session...\n\n",
        "WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:\n\nhttps://cran.rstudio.com/bin/windows/Rtools/\nInstalling package into â€˜C:/Users/wb631166/AppData/Local/R/win-library/4.4â€™\n(as â€˜libâ€™ is unspecified)\ntrying URL 'https://cran.rstudio.com/bin/windows/contrib/4.4/plotly_4.10.4.zip'\nContent type 'application/zip' length 3238522 bytes (3.1 MB)\ndownloaded 3.1 MB\n\n",
        "package â€˜plotlyâ€™ successfully unpacked and MD5 sums checked\n\nThe downloaded binary packages are in\n\tC:\\Users\\wb631166\\AppData\\Local\\Temp\\RtmpoNysOD\\downloaded_packages\n",
        "> ",
        "library(haven)",
        "> ",
        "library(dplyr)",
        "\nAttaching package: â€˜dplyrâ€™\n\nThe following objects are masked from â€˜package:statsâ€™:\n\n    filter, lag\n\nThe following objects are masked from â€˜package:baseâ€™:\n\n    intersect, setdiff, setequal, union\n\n",
        "> ",
        "library(tidyr)",
        "> ",
        "library(stringr)",
        "> ",
        "library(labelled)",
        "> ",
        "library(data.table)",
        "data.table 1.16.0 using 7 threads (see ?getDTthreads).  Latest news: r-datatable.com\n\nAttaching package: â€˜data.tableâ€™\n\nThe following objects are masked from â€˜package:dplyrâ€™:\n\n    between, first, last\n\n",
        "> ",
        "library(ggplot2)",
        "> ",
        "library(shinydashboard)",
        "\nAttaching package: â€˜shinydashboardâ€™\n\nThe following object is masked from â€˜package:graphicsâ€™:\n\n    box\n\n",
        "> ",
        "library(shiny)",
        "> ",
        "library(shinythemes)",
        "> ",
        "library(DT)",
        "\nAttaching package: â€˜DTâ€™\n\nThe following objects are masked from â€˜package:shinyâ€™:\n\n    dataTableOutput, renderDataTable\n\n",
        "> ",
        "library(maps)",
        "> ",
        "library(mapdata)",
        "> ",
        "library(leaflet)",
        "> ",
        "library(DT)",
        "> ",
        "library(rnaturalearth)",
        "> ",
        "library(sf)",
        "Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.3.1; sf_use_s2() is TRUE\n",
        "> ",
        "library(plotly)",
        "\nAttaching package: â€˜plotlyâ€™\n\nThe following object is masked from â€˜package:ggplot2â€™:\n\n    last_plot\n\nThe following object is masked from â€˜package:statsâ€™:\n\n    filter\n\nThe following object is masked from â€˜package:graphicsâ€™:\n\n    layout\n\nWarning message:\npackage â€˜plotlyâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(officer)",
        "Warning message:\npackage â€˜officerâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(flextable)",
        "\nAttaching package: â€˜flextableâ€™\n\nThe following objects are masked from â€˜package:plotlyâ€™:\n\n    highlight, style\n\nWarning message:\npackage â€˜flextableâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(rvg)",
        "Warning message:\npackage â€˜rvgâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(viridis)",
        "Loading required package: viridisLite\n\nAttaching package: â€˜viridisâ€™\n\nThe following object is masked from â€˜package:mapsâ€™:\n\n    unemp\n\nWarning message:\npackage â€˜viridisâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(here)",
        "here() starts at C:/WBG/GitHub/WWBI\nWarning message:\npackage â€˜hereâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(glue)",
        "Warning message:\npackage â€˜glueâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(colourpicker)",
        "\nAttaching package: â€˜colourpickerâ€™\n\nThe following object is masked from â€˜package:shinyâ€™:\n\n    runExample\n\nWarning message:\npackage â€˜colourpickerâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(rmarkdown)",
        "Warning message:\npackage â€˜rmarkdownâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(quarto)",
        "Warning message:\npackage â€˜quartoâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(tinytex)",
        "Warning message:\npackage â€˜tinytexâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(orca)",
        "> ",
        "p <- plot_ly(x = 1:10, y = rnorm(10), type = 'scatter', mode = 'lines')",
        "> ",
        "save_image(p, \"test_plot.png\")",
        "Error in py_module_import(module, convert = convert) : \n  ModuleNotFoundError: No module named 'kaleido'\n\u001B[90mRun \u001B]8;;rstudio:run:reticulate::py_last_error()\u0007`reticulate::py_last_error()`\u001B]8;;\u0007 for details.\u001B[39m\n",
        "> ",
        "reticulate::py_config()",
        "python:         C:/Program Files/Python311/python.exe\nlibpython:      C:/Program Files/Python311/python311.dll\npythonhome:     C:/Program Files/Python311\nversion:        3.11.5 (tags/v3.11.5:cce6ba9, Aug 24 2023, 14:38:34) [MSC v.1936 64 bit (AMD64)]\nArchitecture:   64bit\nnumpy:           [NOT FOUND]\n\nNOTE: Python version was forced by RETICULATE_PYTHON_FALLBACK\n",
        "> ",
        "install.packages(\"reticulate\")  # Install reticulate if not already installed",
        "Error in install.packages : Updating loaded packages\n\nRestarting R session...\n\n",
        "WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:\n\nhttps://cran.rstudio.com/bin/windows/Rtools/\nInstalling package into â€˜C:/Users/wb631166/AppData/Local/R/win-library/4.4â€™\n(as â€˜libâ€™ is unspecified)\ntrying URL 'https://cran.rstudio.com/bin/windows/contrib/4.4/reticulate_1.40.0.zip'\nContent type 'application/zip' length 2205069 bytes (2.1 MB)\ndownloaded 2.1 MB\n\n",
        "package â€˜reticulateâ€™ successfully unpacked and MD5 sums checked\n\nThe downloaded binary packages are in\n\tC:\\Users\\wb631166\\AppData\\Local\\Temp\\RtmpmKe4Q2\\downloaded_packages\n",
        "> ",
        "reticulate::py_install(\"kaleido\")",
        "Using virtual environment \"~/.virtualenvs/r-reticulate\" ...\n",
        "+ \"C:/Users/wb631166/OneDrive - WBG/Documents/.virtualenvs/r-reticulate/Scripts/python.exe\" -m pip install --upgrade --no-user kaleido\n",
        "Requirement already satisfied: kaleido in c:\\users\\wb631166\\onedri~1\\docume~1\\virtua~1\\r-reti~1\\lib\\site-packages (0.2.1)\n",
        "> ",
        "reticulate::py_run_string(\"import kaleido\")",
        "Error in py_run_string_impl(code, local, convert) : \n  ModuleNotFoundError: No module named 'kaleido'\n\u001B[90mRun \u001B]8;;rstudio:run:reticulate::py_last_error()\u0007`reticulate::py_last_error()`\u001B]8;;\u0007 for details.\u001B[39m\n",
        "> ",
        "reticulate::py_last_error()",
        "\n\u001B[36mâ”€â”€\u001B[39m \u001B[1mPython Exception Message\u001B[22m \u001B[36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\u001B[39m\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"\u001B[90m\u001B]8;line = 122;file:",
        "//C:\\Users\\wb631166\\AppData\\Local\\R\\win-library\\4.4\\reticulate\\python\\rpytools\\loader.py\u0007C:\\Users\\wb631166\\AppData\\Local\\R\\win-library\\4.4\\reticulate\\python\\rpytools\\loader.py\u001B]8;;\u0007\u001B[39m\", line 122, in _find_and_load_hook\n    return _run_hook(name, _hook)\n           ^^^^^^^^^^^^^^^^^^^^^^\n  File \"\u001B[90m\u001B]8;line = 96;file://C:\\Users\\wb631166\\AppData\\Local\\R\\win-library\\4.4\\reticulate\\python\\rpytools\\loader.py\u0007C:\\Users\\wb631166\\AppData\\Local\\R\\win-library\\4.4\\reticulate\\python\\rpytools\\loader.py\u001B]8;;\u0007\u001B[39m\", l",
        "ine 96, in _run_hook\n    module = hook()\n             ^^^^^^\n  File \"\u001B[90m\u001B]8;line = 120;file://C:\\Users\\wb631166\\AppData\\Local\\R\\win-library\\4.4\\reticulate\\python\\rpytools\\loader.py\u0007C:\\Users\\wb631166\\AppData\\Local\\R\\win-library\\4.4\\reticulate\\python\\rpytools\\loader.py\u001B]8;;\u0007\u001B[39m\", line 120, in _hook\n    return _find_and_load(name, import_)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nModuleNotFoundError: No module named 'kaleido'\n\n\u001B[36mâ”€â”€\u001B[39m \u001B[1mR Traceback\u001B[22m \u001B[36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â",
        "”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\u001B[39m\n\u001B[90m    \u001B[39mâ–†\n\u001B[90m 1. \u001B[39mâ””â”€\u001B[1mreticulate\u001B[22m::py_run_string(\"import kaleido\")\n\u001B[90m 2. \u001B[39m  â””â”€reticulate:::py_run_string_impl(code, local, conv",
        "ert)\n\u001B[90mSee `reticulate::py_last_error()$r_trace$full_call` for more details.\u001B[39m\n",
        "> ",
        "reticulate::use_python(\"C:/Users/wb631166/OneDrive - WBG/Documents/.virtualenvs/r-reticulate/Scripts/python.exe\", required = TRUE)",
        "ERROR: The requested version of Python ('C:/Users/wb631166/OneDrive -\nWBG/Documents/.virtualenvs/r-reticulate/Scripts/python.exe') cannot be used, as another version of Python ('C:/Program\nFiles/Python311/python.exe') has already been initialized. Please restart the R session if you need to attach reticulate to a\ndifferent version of Python.\nError in reticulate::use_python(\"C:/Users/wb631166/OneDrive - WBG/Documents/.virtualenvs/r-reticulate/Scripts/python.exe\",  : \n  failed to initialize requested version ",
        "of Python\n",
        "> ",
        "reticulate::py_install(\"kaleido\")",
        "Using virtual environment \"~/.virtualenvs/r-reticulate\" ...\n",
        "+ \"C:/Users/wb631166/OneDrive - WBG/Documents/.virtualenvs/r-reticulate/Scripts/python.exe\" -m pip install --upgrade --no-user kaleido\n",
        "Requirement already satisfied: kaleido in c:\\users\\wb631166\\onedri~1\\docume~1\\virtua~1\\r-reti~1\\lib\\site-packages (0.2.1)\n",
        "> ",
        "reticulate::py_run_string(\"import kaleido\")",
        "Error in py_run_string_impl(code, local, convert) : \n  ModuleNotFoundError: No module named 'kaleido'\n\u001B[90mRun \u001B]8;;rstudio:run:reticulate::py_last_error()\u0007`reticulate::py_last_error()`\u001B]8;;\u0007 for details.\u001B[39m\n",
        "> ",
        "reticulate::conda_create(\"r-kaleido-env\")",
        "Error: Unable to find conda binary. Is Anaconda installed?\n",
        "> ",
        "#23358",
        "> ",
        "library(reticulate)",
        "Warning message:\npackage â€˜reticulateâ€™ was built under R version 4.4.2 \n",
        "> ",
        "use_python(\"C:/Users/wb631166/AppData/Roaming/Python/Python311/python.exe\", required = TRUE)",
        "Error in use_python(\"C:/Users/wb631166/AppData/Roaming/Python/Python311/python.exe\",  : \n  Specified version of python 'C:/Users/wb631166/AppData/Roaming/Python/Python311/python.exe' does not exist.\n",
        "> ",
        "use_python(\"C:/wbg/Anaconda3/python.exe\", required = TRUE)",
        "ERROR: The requested version of Python ('C:/wbg/Anaconda3/python.exe') cannot be used, as another version of Python ('C:/Program Files/Python311/python.exe') has already\nbeen initialized. Please restart the R session if you need to attach reticulate to a different version of Python.\nError in use_python(\"C:/wbg/Anaconda3/python.exe\", required = TRUE) : \n  failed to initialize requested version of Python\n",
        "\nRestarting R session...\n\n",
        "> ",
        "library(reticulate)",
        "Warning message:\npackage â€˜reticulateâ€™ was built under R version 4.4.2 \n",
        "> ",
        "use_python(\"C:/wbg/Anaconda3/python.exe\", required = TRUE)",
        "> ",
        "py_config()",
        "python:         C:/WBG/Anaconda3/python.exe\nlibpython:      C:/WBG/Anaconda3/python311.dll\npythonhome:     C:/WBG/Anaconda3\nversion:        3.11.7 | packaged by Anaconda, Inc. | (main, Dec 15 2023, 18:05:47) [MSC v.1916 64 bit (AMD64)]\nArchitecture:   64bit\nnumpy:          C:/WBG/Anaconda3/Lib/site-packages/numpy\nnumpy_version:  1.26.4\n\nNOTE: Python version was forced by use_python() function\n",
        "> ",
        "library(plotly)",
        "Loading required package: ggplot2\n\nAttaching package: â€˜plotlyâ€™\n\nThe following object is masked from â€˜package:ggplot2â€™:\n\n    last_plot\n\nThe following object is masked from â€˜package:statsâ€™:\n\n    filter\n\nThe following object is masked from â€˜package:graphicsâ€™:\n\n    layout\n\nWarning message:\npackage â€˜plotlyâ€™ was built under R version 4.4.2 \n",
        "> ",
        "> ",
        "library(haven)",
        "> ",
        "library(dplyr)",
        "\nAttaching package: â€˜dplyrâ€™\n\nThe following objects are masked from â€˜package:statsâ€™:\n\n    filter, lag\n\nThe following objects are masked from â€˜package:baseâ€™:\n\n    intersect, setdiff, setequal, union\n\n",
        "> ",
        "library(tidyr)",
        "> ",
        "library(stringr)",
        "> ",
        "library(labelled)",
        "> ",
        "library(data.table)",
        "data.table 1.16.0 using 7 threads (see ?getDTthreads).  Latest news: r-datatable.com\n\nAttaching package: â€˜data.tableâ€™\n\nThe following objects are masked from â€˜package:dplyrâ€™:\n\n    between, first, last\n\n",
        "> ",
        "library(ggplot2)",
        "> ",
        "library(shinydashboard)",
        "\nAttaching package: â€˜shinydashboardâ€™\n\nThe following object is masked from â€˜package:graphicsâ€™:\n\n    box\n\n",
        "> ",
        "library(shiny)",
        "> ",
        "library(shinythemes)",
        "> ",
        "library(DT)",
        "\nAttaching package: â€˜DTâ€™\n\nThe following objects are masked from â€˜package:shinyâ€™:\n\n    dataTableOutput, renderDataTable\n\n",
        "> ",
        "library(maps)",
        "> ",
        "library(mapdata)",
        "> ",
        "library(leaflet)",
        "> ",
        "library(DT)",
        "> ",
        "library(rnaturalearth)",
        "> ",
        "library(sf)",
        "Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.3.1; sf_use_s2() is TRUE\n",
        "> ",
        "library(plotly)",
        "> ",
        "library(officer)",
        "Warning message:\npackage â€˜officerâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(flextable)",
        "\nAttaching package: â€˜flextableâ€™\n\nThe following objects are masked from â€˜package:plotlyâ€™:\n\n    highlight, style\n\nWarning message:\npackage â€˜flextableâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(rvg)",
        "Warning message:\npackage â€˜rvgâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(viridis)",
        "Loading required package: viridisLite\n\nAttaching package: â€˜viridisâ€™\n\nThe following object is masked from â€˜package:mapsâ€™:\n\n    unemp\n\nWarning message:\npackage â€˜viridisâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(here)",
        "here() starts at C:/WBG/GitHub/WWBI\nWarning message:\npackage â€˜hereâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(glue)",
        "Warning message:\npackage â€˜glueâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(colourpicker)",
        "\nAttaching package: â€˜colourpickerâ€™\n\nThe following object is masked from â€˜package:shinyâ€™:\n\n    runExample\n\nWarning message:\npackage â€˜colourpickerâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(rmarkdown)",
        "Warning message:\npackage â€˜rmarkdownâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(quarto)",
        "Warning message:\npackage â€˜quartoâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(tinytex)",
        "Warning message:\npackage â€˜tinytexâ€™ was built under R version 4.4.2 \n",
        "> ",
        "library(orca)",
        "> ",
        "# Create a simple plotly chart",
        "> ",
        "fig <- plot_ly(x = c(1, 2, 3), y = c(4, 5, 6), type = 'scatter', mode = 'lines')",
        "> ",
        "> ",
        "export(fig, file = \"plot.png\", engine = \"kaleido\")",
        "Error in webshot::webshot(f, file, ...) : \n  unused argument (engine = \"kaleido\")\nIn addition: Warning message:\nIn export(fig, file = \"plot.png\", engine = \"kaleido\") :\n  'export' is deprecated.\nUse 'orca' instead.\nSee help(\"Deprecated\")\n",
        "> ",
        "orca(fig, \"plot.png\")",
        "Error: The orca command-line utility is required for this functionality.\n\nPlease follow the installation instructions here -- https://github.com/plotly/orca#installation\nIn addition: Warning message:\nIn orca(fig, \"plot.png\") : 'orca' is deprecated.\nUse 'kaleido' instead.\nSee help(\"Deprecated\")\n",
        "> ",
        "fig %>% plotly::export(\"plot.png\", engine = \"kaleido\")",
        "Error in webshot::webshot(f, file, ...) : \n  unused argument (engine = \"kaleido\")\nIn addition: Warning message:\nIn plotly::export(., \"plot.png\", engine = \"kaleido\") :\n  'plotly::export' is deprecated.\nUse 'orca' instead.\nSee help(\"Deprecated\")\n",
        "> ",
        "fig %>% plotly::to_image(format = \"png\", width = 800, height = 600) %>%",
        "+ ",
        "    writeBin(\"plot.png\")",
        "Error: 'to_image' is not an exported object from 'namespace:plotly'\n",
        "> ",
        "use_python(\"C:/wbg/Anaconda3/python.exe\", required = TRUE)",
        "> ",
        "# Define UI",
        "> ",
        "ui <- fluidPage(",
        "+ ",
        "  titlePanel(\"Automated Word Document Creation\"),",
        "+ ",
        "  sidebarLayout(",
        "+ ",
        "    sidebarPanel(",
        "+ ",
        "      downloadButton(\"download_doc\", \"Download Word Document\")",
        "+ ",
        "    ),",
        "+ ",
        "    mainPanel(",
        "+ ",
        "      plotlyOutput(\"plot\")",
        "+ ",
        "    )",
        "+ ",
        "  )",
        "+ ",
        ")",
        "> ",
        "# Define server logic",
        "> ",
        "server <- function(input, output) {",
        "+ ",
        "  ",
        "+ ",
        "  # Generate a simple plotly plot",
        "+ ",
        "  output$plot <- renderPlotly({",
        "+ ",
        "    plot_ly(x = c(1, 2, 3), y = c(4, 5, 6), type = 'scatter', mode = 'lines')",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  # Create the Word document when the user clicks the download button",
        "+ ",
        "  output$download_doc <- downloadHandler(",
        "+ ",
        "    filename = function() {",
        "+ ",
        "      paste(\"Report-\", Sys.Date(), \".docx\", sep = \"\")",
        "+ ",
        "    },",
        "+ ",
        "    content = function(file) {",
        "+ ",
        "      # Create a new Word document",
        "+ ",
        "      doc <- officer::read_docx()",
        "+ ",
        "      ",
        "+ ",
        "      # Add an introduction text",
        "+ ",
        "      doc <- doc %>% ",
        "+ ",
        "        body_add_par(\"This is an automated report.\", style = \"heading 1\") %>%",
        "+ ",
        "        body_add_par(\"Below is a plot generated using the Shiny app.\")",
        "+ ",
        "      ",
        "+ ",
        "      # Add the plot",
        "+ ",
        "      # Save plot as image and add to Word document",
        "+ ",
        "      img_path <- tempfile(fileext = \".png\")",
        "+ ",
        "      plotly::export(output$plot(), img_path)",
        "+ ",
        "      doc <- doc %>% body_add_img(src = img_path, width = 6, height = 4)",
        "+ ",
        "      ",
        "+ ",
        "      # Save the document",
        "+ ",
        "      print(doc, target = file)",
        "+ ",
        "    }",
        "+ ",
        "  )",
        "+ ",
        "}",
        "> ",
        "# Run the application",
        "> ",
        "shinyApp(ui = ui, server = server)",
        "\nListening on http://127.0.0.1:5729\nWarning in plotly::export(output$plot(), img_path) :\n  'plotly::export' is deprecated.\nUse 'orca' instead.\nSee help(\"Deprecated\")\nWarning: Error in $: Can't read output 'plot'\n  3: \u001B[37mrunApp\u001B[39m\n  2: \u001B[37mprint.shiny.appobj\u001B[39m\n  1: \u001B[37m<Anonymous>\u001B[39m\n\n",
        "> ",
        "# Define server logic",
        "> ",
        "server <- function(input, output) {",
        "+ ",
        "  ",
        "+ ",
        "  # Create a plotly plot and save it as an object",
        "+ ",
        "  plot_obj <- plot_ly(x = c(1, 2, 3), y = c(4, 5, 6), type = 'scatter', mode = 'lines')",
        "+ ",
        "  ",
        "+ ",
        "  # Render the plot in the UI",
        "+ ",
        "  output$plot <- renderPlotly({",
        "+ ",
        "    plot_obj",
        "+ ",
        "  })",
        "+ ",
        "  ",
        "+ ",
        "  # Create the Word document when the user clicks the download button",
        "+ ",
        "  output$download_doc <- downloadHandler(",
        "+ ",
        "    filename = function() {",
        "+ ",
        "      paste(\"Report-\", Sys.Date(), \".docx\", sep = \"\")",
        "+ ",
        "    },",
        "+ ",
        "    content = function(file) {",
        "+ ",
        "      # Create a new Word document",
        "+ ",
        "      doc <- officer::read_docx()",
        "+ ",
        "      ",
        "+ ",
        "      # Add an introduction text",
        "+ ",
        "      doc <- doc %>% ",
        "+ ",
        "        body_add_par(\"This is an automated report.\", style = \"heading 1\") %>%",
        "+ ",
        "        body_add_par(\"Below is a plot generated using the Shiny app.\")",
        "+ ",
        "      ",
        "+ ",
        "      # Save the plot as an image using plotly::to_image",
        "+ ",
        "      img_path <- tempfile(fileext = \".png\")",
        "+ ",
        "      img <- plotly::to_image(plot_obj, format = \"png\", width = 800, height = 600)",
        "+ ",
        "      writeBin(img, img_path)",
        "+ ",
        "      ",
        "+ ",
        "      # Add the image to the Word document",
        "+ ",
        "      doc <- doc %>% body_add_img(src = img_path, width = 6, height = 4)",
        "+ ",
        "      ",
        "+ ",
        "      # Save the document",
        "+ ",
        "      print(doc, target = file)",
        "+ ",
        "    }",
        "+ ",
        "  )",
        "+ ",
        "}",
        "> ",
        "# Run the application",
        "> ",
        "shinyApp(ui = ui, server = server)",
        "\nListening on http://127.0.0.1:5729\nWarning: Error in : 'to_image' is not an exported object from 'namespace:plotly'\n  3: \u001B[37mrunApp\u001B[39m\n  2: \u001B[37mprint.shiny.appobj\u001B[39m\n  1: \u001B[37m<Anonymous>\u001B[39m\n",
        "> ",
        "install.packages(\"plotly\")",
        "Error in install.packages : Updating loaded packages\n\nRestarting R session...\n\n"
    ]
}